Some cleanup and tweaks to the build process (i.e. configure, makefile.in and
generate) so that it builds with vcpkg. Specifically, we modify them to use the
following environment variables (which are set by our portfile):
- $CADICAL_INSTALL_DIR to indicate the directory that vcpkg installed cadical to.
- $CADICAL_VERSION to indicate Cadical's version string.
- $CADICAL_GITID to indicate Cadical's git commit ID string.

These tweaks are needed as previously, the build process assumed that Cadical was
built in its git repository which lives in the parent directory of Cadiback's
source, i.e. "<path_to_cadiback_source>/../cadical", so that it could obtain
the built files, version and git commit ID strings from there. 
However, we can no longer assume such a directory structure as we are compiling
and installing our dependencies (including Cadical) via vcpkg.
Hence, we tweak the build process to use these environment variables, which we 
set in our portfile.

diff --git a/configure b/configure
index cb7ca06..17f2106 100755
--- a/configure
+++ b/configure
@@ -34,16 +34,13 @@ checkfile () {
   [ -f "$1" ] || die "could not find '$1'"
 }
 
-[ x"$CADICAL" = x ] && CADICAL="../cadical"
+checkdir "$CADICAL_INSTALL_DIR"
 
-checkdir "$CADICAL"
-cadicalversion="`cat $CADICAL/VERSION`"
+checkdir "$CADICAL_INSTALL_DIR/include"
+checkdir "$CADICAL_INSTALL_DIR/lib"
 
-checkdir "$CADICAL/src"
-checkdir "$CADICAL/build"
-
-checkfile "$CADICAL/src/cadical.hpp"
-checkfile "$CADICAL/build/libcadical.a"
+checkfile "$CADICAL_INSTALL_DIR/include/cadical.hpp"
+checkfile "$CADICAL_INSTALL_DIR/lib/libcadical.a"
 
 while [ $# -gt 0 ]
 do
@@ -56,9 +53,9 @@ do
   shift
 done
 
-msg "Using CADICAL='$CADICAL' version '$cadicalversion'"
+msg "Using CADICAL='$CADICAL_INSTALL_DIR'"
 
-if [ x"`grep 'bool flip' $CADICAL/src/cadical.hpp`" = x ]
+if [ "$(grep 'bool flip' "$CADICAL_INSTALL_DIR"/include/cadical.hpp)" = "" ]
 then
   [ $flip = no ] || \
     die "no 'CaDiCaL' support for 'bool flip (int lit)' (update version or use '--no-flip')"
@@ -68,14 +65,14 @@ else
   flip=yes
 fi
 
-if [ x"$CXX" = x ]
+if [ "$CXX" = "" ]
 then
   COMPILE="g++ -fPIC -Wall"
 else
   COMPILE="$CXX -fPIC -W"
 fi
 
-if [ x"$AR" = x ]
+if [ "$AR" = "" ]
 then
   LINK="ar"
 else
@@ -94,6 +91,6 @@ fi
 msg "Compiling with '$COMPILE'"
 
 rm -f makefile
-sed -e "s#@COMPILE@#$COMPILE#" makefile.in | sed -e "s/@LINK@/$LINK/" > makefile
+sed -e "s|@COMPILE@|$COMPILE|" makefile.in | sed -e "s|@LINK@|$LINK|" > makefile
 
 msg "Generated 'makefile' (run 'make' to compile)"
diff --git a/generate b/generate
index 4d0d0bb..fc4ab93 100755
--- a/generate
+++ b/generate
@@ -1,16 +1,6 @@
 #!/bin/sh
-die () {
-  echo "generate: error: $*" 1>&2
-  exit 1
-}
-[ -f VERSION ] || die "could not find 'VERSION' file"
-[ -d .git ] || die "could not find '.git' directory"
-[ -f makefile ] || die "could not find 'makefile'"
-VERSION="`cat VERSION`"
-GITID="`git show|head -1|awk '{print $2}'`"
-BUILD="`sed '/^COMPILE/!d;s,^COMPILE=,,;s, -I.*,,' makefile`"
 cat <<EOF
-#define VERSION "$VERSION"
-#define GITID "$GITID"
-#define BUILD "$BUILD"
+#define VERSION "$CADICAL_VERSION"
+#define GITID "$CADICAL_GITID"
+#define BUILD "$(sed '/^COMPILE/!d;s,^COMPILE=,,;s, -I.*,,' makefile)"
 EOF
diff --git a/makefile.in b/makefile.in
index f13db42..033e2e9 100644
--- a/makefile.in
+++ b/makefile.in
@@ -1,12 +1,12 @@
 COMPILE=@COMPILE@
 LINK=@LINK@
 all: libcadiback.a libcadiback.so
-libcadiback.a: cadiback.o ../cadical/build/libcadical.a makefile
+libcadiback.a: cadiback.o ${CADICAL_INSTALL_DIR}/lib/libcadical.a makefile
 	$(LINK) rcs $@ cadiback.o
-libcadiback.so: cadiback.o ../cadical/build/libcadical.so makefile
-	$(COMPILE) -shared -o $@ cadiback.o -L../cadical/build/ -lcadical
-cadiback.o: cadiback.cpp config.hpp ../cadical/src/cadical.hpp makefile
-	$(COMPILE) -c $< -I../cadical/src
+libcadiback.so: cadiback.o ${CADICAL_INSTALL_DIR}/lib/libcadical.so makefile
+	$(COMPILE) -shared -o $@ cadiback.o -L${CADICAL_INSTALL_DIR}/lib/ -lcadical
+cadiback.o: cadiback.cpp config.hpp ${CADICAL_INSTALL_DIR}/include/cadical.hpp makefile
+	$(COMPILE) -c $< -I${CADICAL_INSTALL_DIR}/include
 config.hpp: generate VERSION makefile
 	./generate > $@
 clean:
